# 生命周期函数

生命周期函数说白了就是让我们在一个组件的各个阶段都提供一些钩子函数来让开发者在合适的时间点可以介入并进行一些操作，比如初始化(onCreate)的时候我们应该初始化组件相关的状态和变量，组件要销毁(onDestroy)时把一些数据结构销毁掉以节约内存，防止后台任务一直运行。

总的来说 React 组件的生命周期分为三个部分: 装载期间(Mounting) ，更新期间(Updating) 和卸载期间(Unmounting) ，React16 多出来一个 componentDidCatch() 函数用于捕捉错误

- 初始化阶段 constructor -> static getDerivedStateFromProps() -> render() -> componentDidMount()
- 运行中阶段 static getDerivedStateFromProps() -> shouldComponentUpdate() -> render() -> getSnapshotBeforeUpdate() -> componentDidUpdate()
- 销毁阶段 componentWillUnmount()

## react16 新生命周期，有什么变化

React16.3+废弃的三个生命周期函数

componentWillMount

componentWillReceiveProps

componentWillUpdate

取而代之的是两个新的生命周期函数

static getDerivedStateFromProps(nextProps, prevState) 取代 componentWillMount、componentWillReceiveProps 和 componentWillUpdate

getSnapshotBeforeUpdate(prevProps, prevState) 取代 componentWillUpdate

componentWillReceiveProps(nextProps): 移除这个 api 基于如下考虑:

- 语义不太契合逻辑
- phase1 阶段会多次调用
  新的钩子 getDerivedStateFromProps() 更加纯粹, 它做的事情是将新传进来的属性和当前的状态值进行对比, 若不一致则更新当前的状态。

## 在未来 17 的版本中, 将移除的生命周期钩子如下:

- componentWillMount(): 移除这个 api 基于以下两点考虑:
- 服务端渲染: 在服务端渲染的情景下, componentWillMount 执行完立马执行 render 会导致 componentWillMount 里面执行的方法(获取数据, 订阅事件) 并不一定执行完;
- Concurrent Render: 在 fiber 架构下, render 前的钩子会被多次调用, 在 componentWillMount 里执行订阅事件就会产生内存泄漏;
