# 三次握手和四次挥手

## TCP 三次握手

建立连接前，客户端和服务端需要通过握手来确认对方:

客户端发送 syn(同步序列编号) 请求，进入 syn_send 状态，等待确认

服务端接收并确认 syn 包后发送 syn+ack（确认字符） 包，进入 syn_recv 状态

客户端接收 syn+ack 包后，发送 ack 包，双方进入 established 状态

## TCP 四次挥手

客户端 -- FIN --> 服务端， FIN—WAIT
服务端 -- ACK --> 客户端， CLOSE-WAIT
服务端 -- ACK,FIN --> 客户端， LAST-ACK
客户端 -- ACK --> 服务端，CLOSED

1. 为什么需要三次握手？
   为了确保双发收发都是正常的。
2. 为什么需要四次挥手？
   双方数据发送完毕，都认为可以断开。
3. 为什么需要等待？
   A 向 B 发的 FIN 可能丢失。
4. 为什么握手是 3 次，而挥手是 4 次呐？
   当服务器端收到 FIN 报文时，很可能并不会立即关闭 SOCKET。
