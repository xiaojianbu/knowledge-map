# 策略模式

## 概念

定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。

## 策略模式的目的

将算法的使用与算法的实现分离开来。

## 例子

```js
//封装的策略算法
var strategies = {
  S: function(salary) {
    return salary * 4
  },
  A: function(salary) {
    return salary * 3
  },
  B: function(salary) {
    return salary * 2
  }
}

//具体的计算方法
var calculateBonus = function(level, salary) {
  return strategies[level](salary)
}

console.log(calculateBonus('S', 1000))
console.log(calculateBonus('A', 4000))
```

### 策略模式实现的表单校验

```js
//策略对象

var strategies = {
  isNonEmpty: function(value, errorMsg) {
    if (value === '') {
      return errorMsg
    }
  },
  minLength: function(value, length, errorMg) {
    if (value.length < length) {
      return errorMg
    }
  },
  isMobile: function(value, errorMsg) {
    if (!/(^1[3|5|8][0-9]{9}$)/.test(value)) {
      return errorMsg
    }
  }
}

/**
 * Validator 类
 * @constructor
 */
var Validator = function() {
  this.cache = []
}

Validator.prototype.add = function(dom, rules) {
  var self = this

  for (var i = 0, rule; (rule = rules[i++]); ) {
    ;(function(rule) {
      var strategyAry = rule.strategy.split(':')
      var errorMsg = rule.errorMsg

      self.cache.push(function() {
        var strategy = strategyAry.shift()
        strategyAry.unshift(dom.value)
        strategyAry.push(errorMsg)
        return strategies[strategy].apply(dom, strategyAry)
      })
    })(rule)
  }
}

Validator.prototype.start = function() {
  for (var i = 0, validatorFunc; (validatorFunc = this.cache[i++]); ) {
    var errorMsg = validatorFunc()
    if (errorMsg) {
      return errorMsg
    }
  }
}

//客户端调用的代码

var registerForm = document.getElementById('registerForm')
var validataFunc = function() {
  var validator = new Validator()

  validator.add(registerForm.userName, [
    {
      strategy: 'isNonEnpty',
      errorMsg: '用户名不能为空'
    },
    {
      strategy: 'minLength',
      errorMsg: '用户名长度不能小于10位'
    }
  ])

  // validator.add(registerForm.password,[])

  var errorMsg = validator.start()
  return errorMsg
}

registerForm.onsubmit = function() {
  var errorMsg = validataFunc()

  if (errorMsg) {
    alert(errorMsg)
    return false
  }
}
```
